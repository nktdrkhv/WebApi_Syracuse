<!-- wp -->

<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1" name="viewport"/>
    <link crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
          integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" rel="stylesheet"/>
</head>

<body>
<br/>
<br/>
<div class="container">
    <div class="row justify-content-center">
        <div class="col-6 text-left">
            <div>
                <label class="input-group-text" for="wp-q">Загрузите программу тренировок</label>
                <input class="form-control" id="wp" name="wp-q" type="file">
            </div>
            <div>
                <input id="key" name="key" type="hidden">
            </div>
            <br/>
            <div>
                <label class="input-group-text" for="gender">Пол</label>
                <select class="form-select" id="gender" name="gender">
                    <option value="13">Мужчина</option>
                    <option value="14">Женщина</option>
                </select>
            </div>
            <br/>
            <div>
                <label class="input-group-text" for="activity-level">Количество тренировок в неделю</label>
                <select class="form-select" id="activity-level" name="activity-level">
                    <option value="18">2</option>
                    <option value="19">3</option>
                    <option value="20">4</option>
                    <option value="21">5</option>
                </select>
            </div>
            <br/>
            <div>
                <label class="input-group-text" for="purpouse">Цель</label>
                <select class="form-select" id="purpouse" name="purpouse">
                    <option value="1">Похудение</option>
                    <option value="2">Поддержание</option>
                    <option value="3">Набор</option>
                </select>
            </div>
            <br/>
            <div>
                <label class="input-group-text" for="focus">Фокус</label>
                <select class="form-select" id="focus" name="focus">
                    <option></option>
                    <option value="9">Плечи</option>
                    <option value="10">Спина</option>
                    <option value="11">Ягодицы</option>
                    <option value="12">Ноги</option>
                </select>
            </div>
            <br/>
            <div>
                <label class="input-group-text" for="diseases">Заболевания</label>
                <input class="form-control" id="diseases" name="diseases" placeholder="Необязятельно для ввода"
                       type="text">
            </div>
            <br/>
            <div>
                <label class="input-group-text" for="ignore-diseases">Игнорировать заболевания</label>
                <select class="form-select" id="ignore-diseases" name="ignore-diseases">
                    <option value="22">Да</option>
                    <option value="23">Нет</option>
                </select>
            </div>
            <br/>
            <div>
                <button class="btn btn-primary" onclick="send();" type="submit">Загрузить</button>
            </div>
        </div>
    </div>
</div>
<br/>
<br/>

<script>
        (new URL(document.URL)).searchParams.forEach((x, y) => {
            document.getElementById(y).value = x;
            console.log(document.getElementById(y).value + " - " + x);
        });


        const input = document.getElementById("wp");
        var base64file;

        const convertBase64 = (file) => {
            return new Promise((resolve, reject) => {
                const fileReader = new FileReader();
                fileReader.readAsDataURL(file);

                fileReader.onload = () => {
                    var plain = fileReader.result
                        .replace('data:', '')
                        .replace(/^.+,/, '');
                    resolve(plain);
                };

                fileReader.onerror = (error) => {
                    reject(error);
                };
            });
        };

        const uploadPdf = async (event) => {
            const file = event.target.files[0];
            const base64 = await convertBase64(file);
            base64file = base64;
        };

        input.addEventListener("change", (e) => {
            uploadPdf(e);
        });

        function send() {
            let formData = new FormData();
            formData.append("token", "f30677a6-0e15-4e64-87b0-2097a9fdd53a");
            formData.append("key", document.getElementById("key").value);
            formData.append("formname", "add-workout-program");
            formData.append("gender", document.getElementById("gender").value);
            formData.append("activity-level", document.getElementById("activity-level").value);
            formData.append("focus", document.getElementById("focus").value);
            formData.append("purpouse", document.getElementById("purpouse").value);
            formData.append("diseases", document.getElementById("diseases").value);
            formData.append("ignore-diseases", document.getElementById("ignore-diseases").value);
            formData.append("file", base64file);

            alert("После нажатия на ОК начнётся загрузка, дождитесь следующего уведомления");

            let xhr = new XMLHttpRequest();
            xhr.open("POST", "https://core.korablev-team.ru/tildaForm", false);
            xhr.send(formData);

            alert("Программа тренировок загружена");
        }

    



</script>
</body>

</html>