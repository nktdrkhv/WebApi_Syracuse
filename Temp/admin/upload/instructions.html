<!-- instructions -->

<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous" />
</head>

<body>
    <br />
    <br />
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-6 text-left">
                <br />
                <label for="instructions">Загрузите инструкции к питанию</label>
                <input type="file" class="form-control" id="instructions" aria-describedby="instructions-helps">
                <small id="instructions-helps" class="form-text text-muted">Один файл в формате Pdf</small>
                <br />
                <button type="submit" class="btn btn-primary" onclick="send();">Загрузить</button>
                <br />
            </div>
        </div>
    </div>

    <script>
        const input = document.getElementById("recepies");
        var base64file;

        const convertBase64 = (file) => {
            return new Promise((resolve, reject) => {
                const fileReader = new FileReader();
                fileReader.readAsDataURL(file);

                fileReader.onload = () => {
                    var plain = fileReader.result
                        .replace('data:', '')
                        .replace(/^.+,/, '');
                    resolve(plain);
                };

                fileReader.onerror = (error) => {
                    reject(error);
                };
            });
        };

        const uploadFile = async (event) => {
            const file = event.target.files[0];
            const base64 = await convertBase64(file);
            base64file = base64;
        };

        input.addEventListener("change", (e) => {
            uploadFile(e);
        });

        function send() {
            let formData = new FormData();
            formData.append("token", "f30677a6-0e15-4e64-87b0-2097a9fdd53a");
            formData.append("formname", "load-instructions")
            formData.append("file", base64file);

            alert("После нажатия на ОК начнётся загрузка, дождитесь следующего уведомления");

            let xhr = new XMLHttpRequest();
            xhr.open("POST", "https://core.korablev-team.ru/tildaForm", false);
            xhr.send(formData);

            alert("Инструкции загружены");
        }

    </script>
</body>

</html>